"use strict";!function(i){nggProgressBar={settings:{header:"",id:"progressbar",init:!1,maxStep:100,wait:!1,finishedNote:"Done!",submitNGGFormOnFinished:!0,includeTinyMCEHackForIncrements:!0},width:0,init:function(t){var e=this;return t=this.settings=i.extend({},this.settings,{},t||{}),this.adjust_max_step(t.maxStep),0===i("#"+t.id+"_dialog").length&&(t.header=t.header.length>0?t.header:"",i("body").append('<div id="'+t.id+'_dialog"><div id="'+t.id+'" class="progressborder"><div class="'+t.id+'"><span>0%</span></div></div></div>'),i("#"+t.id+"_dialog").dialog({width:640,resizable:!0,modal:!0,title:t.header,position:{my:"center",at:"center",of:this.find_parent(window)},close:function(i,t){e.remove_dialog(0,0)}})),this.div=i("#"+t.id+"_dialog"),t.init=!0,this.div},adjust_max_step:function(i){this.settings.maxStep=i,this.width=Math.round(100/i*100)/100},find_parent:function(i){try{i&&i.parent&&(i=i.parent)}catch(i){}return i},addMessage:function(t){var e=this.settings;e.init||this.init();var n=this.div;0===n.find("#"+e.id+"_message").length?n.append('<div class="'+e.id+'_message"><span style="display:block" id="'+e.id+'_message">'+t+"</span></div>"):i("#"+e.id+"_message").html(t)},addNote:function(t,e){var n=this.settings;n.init||this.init();var s=this.div;n.wait=!0,0===s.find("#"+n.id+"_note").length&&s.append('<ul id="'+n.id+'_note">&nbsp;</ul>'),e?i("#"+n.id+"_note").append("<li>"+t+"<div class='show_details'><span>[more]</span><br />"+e+"</div></li>"):i("#"+n.id+"_note").append("<li>"+t+"</li>"),s.dialog("option","height",220)},increase:function(t){var e=this.settings,n=t*this.width+"%",s=Math.round(t*this.width)+"%";if(i("#"+e.id+" div").width(n),i("#"+e.id+" span").html(s),e.includeTinyMCEHackForIncrements){i(this.find_parent(window).document).scrollTop(0);var r=i(this.find_parent(window).frameElement).parent(),a=r.css("top");setTimeout(function(){r.css("top",0)},1),setTimeout(function(){r.css("top",a)},3)}},finished:function(t){var e=this.settings;t=void 0===t?e.finishedNote:t,i("#"+e.id+" div").width("100%"),i("#"+e.id+" span").html("100%");var n=this.div,s=this;e.wait?(i("#"+e.id).delay(1e3).hide("slow"),s.addNote(t),n.on("click",function(){s.remove_dialog(!1,0)})):window.setTimeout(function(){s.remove_dialog(!0,1)},1e3)},remove_dialog:function(t,e){var n=i("#"+this.settings.id+"_dialog");if(t?n.delay(4e3).dialog("destroy"):n.dialog("destroy"),n.remove(),this.settings.submitNGGFormOnFinished){var s=i(".nggform");s.prepend('<input type="hidden" name="ajax_callback" value="'+e+'">'),t?s.delay(4e3).trigger("submit"):s.trigger("submit")}}}}(jQuery);var nggProgressBarManager={starting_count:0,progress_bar:null,polling_status:!1,button:null,messages:{no_images_found:"No images were found to operate on",operation_finished:"Operation has completed",header:"Working..."},initialize:function(i,t,e,n){var s=this;this.messages=t,this.primary_url=e,this.secondary_url=void 0===n?e:n,this.button=document.getElementById(i),this.button.addEventListener("click",function(i){i.preventDefault(),s.button.setAttribute("disabled","true"),s.first_fetch()})},initialize_progress_bar:function(){if(this.progress_bar)return this.progress_bar;var i=this;this.progress_bar=nggProgressBar.init({header:this.messages.header,wait:!0,finishedNote:this.messages.operation_finished,submitNGGFormOnFinished:!1,includeTinyMCEHackForIncrements:!1}),this.progress_bar.on("dialogclose",function(){i.polling_status=!1,i.progress_bar=null,i.button.removeAttribute("disabled")})},first_fetch:function(){this.initialize_progress_bar();var i=this;fetch(this.primary_url,{method:"post",cache:"no-cache"}).then(function(i){return i.json()}).then(function(t){0===t.remaining?(i.button.removeAttribute("disabled"),nggProgressBar.finished(i.messages.no_images_found)):(i.polling_status=!0,i.starting_count=t.remaining,nggProgressBar.adjust_max_step(i.starting_count),i.continuing_fetch())})},continuing_fetch:function(){var i=this;fetch(this.secondary_url,{method:"post",cache:"no-cache"}).then(function(i){return i.json()}).then(function(t){var e=Math.round((i.starting_count-t.remaining)/i.starting_count*100);e<100?(nggProgressBar.increase(e),i.polling_status&&i.continuing_fetch()):(nggProgressBar.increase(100),nggProgressBar.finished(),i.button.removeAttribute("disabled"))})}};