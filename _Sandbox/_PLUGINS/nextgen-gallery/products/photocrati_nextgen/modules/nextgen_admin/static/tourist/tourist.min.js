"use strict";(function(t){var e,o,i,n,s={}.hasOwnProperty,r=function(t,e){function o(){this.constructor=t}for(var i in e)s.call(e,i)&&(t[i]=e[i]);return o.prototype=e.prototype,t.prototype=new o,t.__super__=e.prototype,t},p=function(t,e){return function(){return t.apply(e,arguments)}};window.Tourist=window.Tourist||{},Tourist.Model=function(t){function o(){return e=o.__super__.constructor.apply(this,arguments)}return r(o,t),o.prototype._module="Tourist",o}(Backbone.Model),window.Tourist.Tip=window.Tourist.Tip||{},Tourist.Tip.Base=function(){function e(e){this.options=null!=e?e:{},this.onClickNext=p(this.onClickNext,this),this.onClickClose=p(this.onClickClose,this),this.el=t("<div/>"),this.initialize(e),this._bindClickEvents(),Tourist.Tip.Base._cacheTip(this)}return e.prototype._module="Tourist",_.extend(e.prototype,Backbone.Events),e.prototype.skipButtonTemplate='<button class="btn btn-default btn-sm pull-right tour-next">Skip this step →</button>',e.prototype.nextButtonTemplate='<button class="btn btn-primary btn-sm pull-right tour-next">Next step →</button>',e.prototype.finalButtonTemplate='<button class="btn btn-primary btn-sm pull-right tour-next">Finish up</button>',e.prototype.closeButtonTemplate='<a class="btn btn-close tour-close" href="#"><i class="icon icon-remove"></i></a>',e.prototype.okButtonTemplate='<button class="btn btn-sm tour-close btn-primary">Okay</button>',e.prototype.actionLabelTemplate=_.template('<h4 class="action-label"><%= label %></h4>'),e.prototype.actionLabels=["Do this:","Then this:","Next this:"],e.prototype.highlightClass="tour-highlight",e.prototype.template=_.template('<div>\n  <div class="tour-container">\n    <%= close_button %>\n    <%= content %>\n    <p class="tour-counter <%= counter_class %>"><%= counter%></p>\n  </div>\n  <div class="tour-buttons">\n    <%= buttons %>\n  </div>\n</div>'),e.prototype.destroy=function(){return this.el.remove()},e.prototype.render=function(t){return this.hide(),t&&(this._setTarget(t.target||!1,t),this._setZIndex(""),this._renderContent(t,this._buildContentElement(t)),t.target&&this.show(),t.zIndex&&this._setZIndex(t.zIndex,t)),this},e.prototype.show=function(){},e.prototype.hide=function(){},e.prototype.setTarget=function(t,e){return this._setTarget(t,e)},e.prototype.cleanupCurrentTarget=function(){return this.target&&this.target.removeClass&&this.target.removeClass(this.highlightClass),this.target=null},e.prototype.onClickClose=function(t){return this.trigger("click:close",this,t),!1},e.prototype.onClickNext=function(t){return this.trigger("click:next",this,t),!1},e.prototype._getTipElement=function(){},e.prototype._renderContent=function(t,e){},e.prototype._bindClickEvents=function(){var t;return t=this._getTipElement(),t.on("click",".tour-close",this.onClickClose),t.on("click",".tour-next",this.onClickNext)},e.prototype._setTarget=function(t,e){return this.cleanupCurrentTarget(),t&&e&&e.highlightTarget&&t.addClass(this.highlightClass),this.target=t},e.prototype._setZIndex=function(t){var e;return e=this._getTipElement(),e.css("z-index",t||"")},e.prototype._buildContentElement=function(e){var o,i;return o=this._buildButtons(e),i=t(t.parseHTML(this.template({content:e.content,buttons:o,close_button:this._buildCloseButton(e),counter:e.final?"":"step "+(e.index+1)+" of "+e.total,counter_class:e.final?"final":""}))),o||i.find(".tour-buttons").addClass("no-buttons"),this._renderActionLabels(i),i},e.prototype._buildButtons=function(t){var e;return e="",t.okButton&&(e+=this.okButtonTemplate),t.skipButton&&(e+=this.skipButtonTemplate),t.nextButton&&(e+=t.final?this.finalButtonTemplate:this.nextButtonTemplate),e},e.prototype._buildCloseButton=function(t){return t.closeButton?this.closeButtonTemplate:""},e.prototype._renderActionLabels=function(e){var o,i,n,s,r,p,u;for(n=e.find(".action"),i=0,u=[],r=0,p=n.length;r<p;r++)o=n[r],s=t(t.parseHTML(this.actionLabelTemplate({label:this.actionLabels[i]}))),s.insertBefore(o),u.push(i++);return u},e._cacheTip=function(t){return Tourist.Tip.Base._cachedTips||(Tourist.Tip.Base._cachedTips=[]),Tourist.Tip.Base._cachedTips.push(t)},e.destroy=function(){var t,e,o,i;if(Tourist.Tip.Base._cachedTips){for(i=Tourist.Tip.Base._cachedTips,e=0,o=i.length;e<o;e++)t=i[e],t.destroy();return Tourist.Tip.Base._cachedTips=null}},e}(),Tourist.Tip.Bootstrap=function(e){function i(){return o=i.__super__.constructor.apply(this,arguments)}return r(i,e),i.prototype.initialize=function(t){var e;return e={showEffect:null,hideEffect:null},this.options=_.extend(e,t),this.tip=new Tourist.Tip.BootstrapTip(this.options)},i.prototype.destroy=function(){return this.tip.destroy(),i.__super__.destroy.call(this)},i.prototype.show=function(){var t;return this.options.showEffect?(t=Tourist.Tip.Bootstrap.effects[this.options.showEffect],t.call(this,this.tip,this.tip.el)):this.tip.show()},i.prototype.hide=function(){var t;return this.options.hideEffect?(t=Tourist.Tip.Bootstrap.effects[this.options.hideEffect],t.call(this,this.tip,this.tip.el)):this.tip.hide()},i.prototype._getTipElement=function(){return this.tip.el},i.prototype._setTarget=function(t,e){return i.__super__._setTarget.call(this,t,e),this.tip.setTarget(t)},i.prototype._renderContent=function(e,o){var i,n;return n=e.my||"left center",i=e.at||"right center",this.tip.setContainer(e.container||t("body")),this.tip.setContent(o),this.tip.setPosition(e.target||!1,n,i)},i}(Tourist.Tip.Base),Tourist.Tip.Bootstrap.effects={slidein:function(e,o){var i,n,s,r,p,u,h,l,a;for(i={top:80,left:80,right:-80,bottom:-80},u=e.my.split(" ")[0],u=u||"top",p=i[u],"bottom"===u&&(u="top"),"right"===u&&(u="left"),h=parseInt(o.css(u)),o.stop(),n={},n[u]=h+p,o.css(n),o.show(),n[u]=h,r=["easeOutCubic","swing","linear"],l=0,a=r.length;l<a&&(s=r[l],!t.easing[s]);l++);return o.animate(n,300,s),null}},Tourist.Tip.BootstrapTip=function(){function e(e){var o;o={offset:10,tipOffset:10},this.options=_.extend(o,e),this.el=t(t.parseHTML(this.template)),this.hide()}return e.prototype.template='<div class="popover tourist-popover">\n  <div class="arrow"></div>\n  <div class="popover-content"></div>\n</div>',e.prototype.FLIP_POSITION={bottom:"top",top:"bottom",left:"right",right:"left"},e.prototype.destroy=function(){return this.el.remove()},e.prototype.show=function(){return this.el.show().addClass("visible")},e.prototype.hide=function(){return this.el.hide().removeClass("visible")},e.prototype.setTarget=function(t){return this.target=t,this._setPosition(this.target,this.my,this.at)},e.prototype.setPosition=function(t,e,o){return this.target=t,this.my=e,this.at=o,this._setPosition(this.target,this.my,this.at)},e.prototype.setContainer=function(t){return t.append(this.el)},e.prototype.setContent=function(t){return this._getContentElement().html(t)},e.prototype._getContentElement=function(){return this.el.find(".popover-content")},e.prototype._getTipElement=function(){return this.el.find(".arrow")},e.prototype._setPosition=function(t,e,o){var i,n,s,r,p,u,h,l,a,c;if(null==e&&(e="left center"),null==o&&(o="right center"),t&&(c=e.split(" "),i=c[0],p=c[1],s=this.el.css("display"),this.el.css({top:0,left:0,margin:0,display:"block"}).removeClass("top").removeClass("bottom").removeClass("left").removeClass("right").addClass(this.FLIP_POSITION[i]),t))return h=this._getTipElement().css({left:"",right:"",top:"",bottom:""}),"center"!==p&&(l={left:h[0].offsetWidth/2,right:0,top:h[0].offsetHeight/2,bottom:0},n={},n[p]=l[p]+this.options.tipOffset,n[this.FLIP_POSITION[p]]="auto",h.css(n)),u=this._caculateTargetPosition(o,t),a=this._caculateTipPosition(e,u),r=this._adjustForArrow(e,a),this.el.css(r),this.el.css({display:s})},e.prototype._caculateTargetPosition=function(t,e){var o,i;return"[object Array]"===Object.prototype.toString.call(e)?{left:e[0],top:e[1]}:(o=this._getTargetBounds(e),i=this._lookupPosition(t,o.width,o.height),{left:o.left+i[0],top:o.top+i[1]})},e.prototype._caculateTipPosition=function(t,e){var o,i,n;return n=this.el[0].offsetWidth,o=this.el[0].offsetHeight,i=this._lookupPosition(t,n,o),{left:e.left-i[0],top:e.top-i[1]}},e.prototype._adjustForArrow=function(t,e){var o,i,n,s,r,p,u;switch(u=t.split(" "),o=u[0],s=u[1],r=this._getTipElement(),p=r[0].offsetWidth,i=r[0].offsetHeight,n={top:e.top,left:e.left},o){case"top":n.top+=i+this.options.offset;break;case"bottom":n.top-=i+this.options.offset;break;case"left":n.left+=p+this.options.offset;break;case"right":n.left-=p+this.options.offset}switch(s){case"left":n.left-=p/2+this.options.tipOffset;break;case"right":n.left+=p/2+this.options.tipOffset;break;case"top":n.top-=i/2+this.options.tipOffset;break;case"bottom":n.top+=i/2+this.options.tipOffset}return n},e.prototype._lookupPosition=function(t,e,o){var i,n,s;return s=e/2,i=o/2,n={"top left":[0,0],"left top":[0,0],"top right":[e,0],"right top":[e,0],"bottom left":[0,o],"left bottom":[0,o],"bottom right":[e,o],"right bottom":[e,o],"top center":[s,0],"left center":[0,i],"right center":[e,i],"bottom center":[s,o]},n[t]},e.prototype._getTargetBounds=function(e){var o,i;return o=e[0],i="function"==typeof o.getBoundingClientRect?o.getBoundingClientRect():{width:o.offsetWidth,height:o.offsetHeight},t.extend({},i,e.offset())},e}(),Tourist.Tip.QTip=function(e){function o(){return this._renderTipBackground=p(this._renderTipBackground,this),i=o.__super__.constructor.apply(this,arguments)}var n,s,u,h;return r(o,e),h=6,u=14,n=10,s={top:80,left:80,right:-80,bottom:-80},o.prototype.QTIP_DEFAULTS={content:{text:" "},show:{ready:!1,delay:0,effect:function(e){var o,i,n,r,p;return i=t(this),r=e.options.position.my,r&&(r=r[r.precedance]),r=r||"top",n=s[r],"bottom"===r&&(r="top"),"right"===r&&(r="left"),p=parseInt(i.css(r)),o={},o[r]=p+n,i.css(o),i.show(),o[r]=p,i.animate(o,300,"easeOutCubic"),null},autofocus:!1},hide:{event:null,delay:0,effect:!1},position:{adjust:{method:"shift shift",scroll:!1}},style:{classes:"ui-tour-tip",tip:{height:h,width:u}},events:{},zindex:2e3},o.prototype.initialize=function(e){return e=t.extend(!0,{},this.QTIP_DEFAULTS,e),this.el.qtip(e),this.qtip=this.el.qtip("api"),this.qtip.render()},o.prototype.destroy=function(){return this.qtip&&this.qtip.destroy(),o.__super__.destroy.call(this)},o.prototype.show=function(){return this.qtip.show()},o.prototype.hide=function(){return this.qtip.hide()},o.prototype._getTipElement=function(){return t("#qtip-"+this.qtip.id)},o.prototype._setTarget=function(t,e){return o.__super__._setTarget.call(this,t,e),this.qtip.set("position.target",t||!1)},o.prototype._renderContent=function(e,o){var i,n,s=this;return n=e.my||"left center",i=e.at||"right center",this._adjustPlacement(n,i),this.qtip.set("content.text",o),this.qtip.set("position.container",e.container||t("body")),this.qtip.set("position.my",n),this.qtip.set("position.at",i),this.qtip.set("position.viewport",e.viewport||!1),this.qtip.set("position.target",e.target||!1),setTimeout(function(){return s._renderTipBackground(n.split(" ")[0])},10)},o.prototype._adjustPlacement=function(t,e){return 0===t.indexOf("top")?this._adjust(0,n):0===t.indexOf("bottom")?this._adjust(0,-n):0===t.indexOf("right")?this._adjust(-n,0):this._adjust(n,0)},o.prototype._adjust=function(t,e){return this.qtip.set("position.adjust.x",t),this.qtip.set("position.adjust.y",e)},o.prototype._renderTipBackground=function(e){var o,i;return i=t("#qtip-"+this.qtip.id+" .qtip-tip"),o=i.find(".qtip-tip-bg"),o.length||(o=t("<div/>",{class:"icon icon-tip qtip-tip-bg"}),i.append(o)),o.removeClass("top left right bottom"),o.addClass(e)},o}(Tourist.Tip.Base),Tourist.Tip.Simple=function(e){function o(){return n=o.__super__.constructor.apply(this,arguments)}return r(o,e),o.prototype.initialize=function(e){return t("body").append(this.el)},o.prototype.show=function(){return this.el.show()},o.prototype.hide=function(){return this.el.hide()},o.prototype._getTipElement=function(){return this.el},o.prototype._renderContent=function(t,e){return this.el.html(e)},o}(Tourist.Tip.Base),Tourist.Tour=function(){function t(t){var e,o;this.options=null!=t?t:{},this.onChangeCurrentStep=p(this.onChangeCurrentStep,this),this.next=p(this.next,this),e={tipClass:"Bootstrap"},this.options=_.extend(e,this.options),this.model=new Tourist.Model({current_step:null}),o=_.extend({model:this.model},this.options.tipOptions),this.view=new Tourist.Tip[this.options.tipClass](o),this.view.bind("click:close",_.bind(this.stop,this,!0)),this.view.bind("click:next",this.next),this.model.bind("change:current_step",this.onChangeCurrentStep)}return _.extend(t.prototype,Backbone.Events),t.prototype.start=function(){return this.trigger("start",this),this.next()},t.prototype.stop=function(t){return t?this._showCancelFinalStep():this._stop()},t.prototype.next=function(){var t,e;return t=this._teardownCurrentStep(),e=0,t&&(e=t.index+1),e<this.options.steps.length?this._showStep(this.options.steps[e],e):e===this.options.steps.length?this._showSuccessFinalStep():this._stop()},t.prototype.setStepOptions=function(t){return this.options.stepOptions=t},t.prototype.onChangeCurrentStep=function(t,e){return this.view.render(e)},t.prototype._showCancelFinalStep=function(){return this._showFinalStep(!1)},t.prototype._showSuccessFinalStep=function(){return this._showFinalStep(!0)},t.prototype._teardownCurrentStep=function(){var t;return t=this.model.get("current_step"),this._teardownStep(t),t},t.prototype._stop=function(){return this._teardownCurrentStep(),this.model.set({current_step:null}),this.trigger("stop",this)},t.prototype._showFinalStep=function(t){var e,o;return e=this._teardownCurrentStep(),o=t?this.options.successStep:this.options.cancelStep,_.isFunction(o)&&(o.call(this,this,this.options.stepOptions),o=null),o?e&&e.final?this._stop():(o.final=!0,this._showStep(o,this.options.steps.length)):this._stop()},t.prototype._showStep=function(t,e){if(t)return t=_.clone(t),t.index=e,t.total=this.options.steps.length,t.final||(t.final=this.options.steps.length===e+1&&!this.options.successStep),t=_.extend(t,this._setupStep(t)),this.model.set({current_step:t})},t.prototype._setupStep=function(t){var e,o,i,n;if(!t||!t.setup)return{};if(t.bind)for(n=t.bind,o=0,i=n.length;o<i;o++)e=n[o],t[e]=_.bind(t[e],t,this,this.options.stepOptions);return t.setup.call(t,this,this.options.stepOptions)||{}},t.prototype._teardownStep=function(t){return t&&t.teardown&&t.teardown.call(t,this,this.options.stepOptions),this.view.cleanupCurrentTarget()},t}()}).call(void 0,jQuery);