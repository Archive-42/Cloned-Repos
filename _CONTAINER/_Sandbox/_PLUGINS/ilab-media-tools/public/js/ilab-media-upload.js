!function(t){var e={};function a(n){if(e[n])return e[n].exports;var i=e[n]={i:n,l:!1,exports:{}};return t[n].call(i.exports,i,i.exports,a),i.l=!0,i.exports}a.m=t,a.c=e,a.d=function(t,e,n){a.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:n})},a.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},a.t=function(t,e){if(1&e&&(t=a(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)a.d(n,i,function(e){return t[e]}.bind(null,i));return n},a.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return a.d(e,"a",e),e},a.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},a.p="/",a(a.s=197)}({197:function(t,e,a){t.exports=a(198)},198:function(t,e){window.ilabAttachmentInfo=function(t,e,a){console.log("Create ilabAttachmentInfo");var n=this;this.info=t(e.attachmentTemplate(a)),this.data=a,this.attachmentTitle=this.info.find('input[name="attachment-title"]'),this.attachmentCaption=this.info.find('textarea[name="attachment-caption"]'),this.attachmentAlt=this.info.find('input[name="attachment-alt"]'),this.attachmentDescription=this.info.find('textarea[name="attachment-description"]'),this.attachmentAlign=this.info.find('select[name="attachment-align"]'),this.attachmentLinkURL=this.info.find('input[name="attachment-link-url"]'),this.attachmentSize=this.info.find('select[name="attachment-size"]'),this.attachmentLinkType=this.info.find('select[name="attachment-link-type"]'),this.saveToken=null;var i=function(){var t={action:"save-attachment",id:n.data.id,nonce:n.data.nonces.update,post_id:window.parent.wp.media.model.settings.post.id,"changes[title]":n.attachmentTitle.val(),"changes[caption]":n.attachmentCaption.val(),"changes[alt]":n.attachmentAlt.val(),"changes[description]":n.attachmentDescription.val()};jQuery.post(ajaxurl,t,(function(t){}))};this.save=function(){clearTimeout(n.saveToken),n.saveToken=setTimeout(i,1e3)};var o=function(t){n.save()};this.attachmentTitle.on("change",o),this.attachmentCaption.on("change",o),this.attachmentAlt.on("change",o),this.attachmentDescription.on("change",o),this.attachmentLinkType.on("change",(function(){var t=n.attachmentLinkType.val();"none"==t?(n.attachmentLinkURL.css({display:"display"}),n.attachmentLinkURL.val("")):"file"==t?(n.attachmentLinkURL.prop("readonly","readonly"),n.attachmentLinkURL.css({display:""}),n.attachmentLinkURL.val(n.data.url)):"post"==t?(n.attachmentLinkURL.prop("readonly","readonly"),n.attachmentLinkURL.css({display:""}),n.attachmentLinkURL.val(n.data.link)):"custom"==t&&(n.attachmentLinkURL.prop("readonly",null),n.attachmentLinkURL.css({display:""}),n.attachmentLinkURL.val(""))})),this.insert=function(){var t={action:"send-attachment-to-editor","attachment[id]":n.data.id,nonce:window.parent.wp.media.view.settings.nonce.sendToEditor,post_id:window.parent.wp.media.model.settings.post.id,"attachment[post_content]":n.attachmentDescription.val(),"attachment[post_excerpt]":n.attachmentCaption.val(),"attachment[image_alt]":n.attachmentAlt.val(),"attachment[image-size]":n.attachmentSize.val(),"attachment[align]":n.attachmentAlign.val(),"attachment[url]":n.attachmentLinkURL.val(),html:""};jQuery.post(ajaxurl,t,(function(t){t.hasOwnProperty("data")&&window.parent.send_to_editor(t.data)}))},this.attachmentLinkURL.css({display:"none"}),e.attachmentContainer.empty(),e.attachmentContainer.append(this.info)},window.ilabMediaUploadItem=function(t,e,a,n){console.log("ilabMediaUploadItem");var i=this;this.cell=t(e.uploadItemTemplate()),this.background=this.cell.find(".ilab-upload-item-background"),this.status=this.cell.find(".ilab-upload-status"),this.progress=this.cell.find(".ilab-upload-progress"),this.progressTrack=this.cell.find(".ilab-upload-progress-track"),null!==n&&(this.uploadDirectory=n),this.status.text("Waiting ..."),this.progressTrack.css({width:"0%"}),this.cell.css({opacity:0}),this.cell.addClass("no-mouse"),this.state="waiting",this.postId=null,this.loader=this.cell.find(".ilab-loader-container"),0==a.type.indexOf("image/")&&a.size<15728640?this.background.css({opacity:.33,"background-image":"url("+URL.createObjectURL(a)+")"}):0==a.type.indexOf("image/")?this.cell.addClass("ilab-upload-cell-image"):0==a.type.indexOf("video/")?this.cell.addClass("ilab-upload-cell-video"):"application/x-photoshop"==a.type?this.cell.addClass("ilab-upload-cell-image"):this.cell.addClass("ilab-upload-cell-doc"),this.deselect=function(){this.cell.removeClass("ilab-upload-selected")},this.updateProgress=function(t){this.progressTrack.css({width:Math.floor(t)+"%"})},this.sizeToFitSize=function(t,e,a,n){if(t<=0||e<=0)return[a,n];if(a<=0&&n<=0)return[0,0];if(a<=0){if(e<=n)return[t,e];var i=n/e;return[Math.round(t*i),n]}if(n<=0){if(t<=a)return[t,e];var o=a/t;return[a,Math.round(e*o)]}var s=a/t,l=n/e;return s<l?[a,Math.round(e*s)]:[Math.round(t*l),n]},this.sizeToFillSize=function(t,e,a,n){if(t<=0||e<=0)return[a,n];var i=a/t,o=n/e,s=[Math.round(t*o),n];return(s[0]<a||s[1]<n)&&(s=[a,Math.round(e*i)]),s},this.itemUploaded=function(t,a){if(t){if(this.progress.css({display:"none"}),this.status.css({display:"none"}),this.background.css({opacity:""}),this.state="ready",this.postId=a.data.id,a.data.thumb){this.loader.css({opacity:1});var n=new Image;n.onload=function(){this.background.css({"background-image":"url("+a.data.thumb+")"}),this.loader.css({opacity:0})}.bind(this),n.src=a.data.thumb}this.cell.removeClass("no-mouse")}else this.progress.css({display:"none"}),this.status.text("Error."),this.cell.addClass("upload-error");e.uploadFinished(this)},this.updateStatusText=function(t){i.status.text("Uploading ...")},this.startUpload=function(){t(document).trigger("ilab.upload-started"),i.uploadToStorage(a,null,a.type,i)},this.set=function(t){t.hasOwnProperty("progress")&&i.updateProgress(t.progress),t.hasOwnProperty("state")&&"uploading"==t.state&&i.updateStatusText("Uploading ...")},this.uploadFinished=function(t,e,a,n){console.log("old uploadFinished");var o={action:"ilab_upload_import_cloud_file",key:t};null!=e&&(o.faces=e),null!=n&&(o.metadata=n),null!=a&&(o.other_sizes=a),jQuery.post(ajaxurl,o,(function(t){i.itemUploaded("success"==t.status,t)}))},this.uploadError=function(){i.progress.css({display:"none"}),i.status.text("Error uploading."),e.uploadFinished(i)},e.cellContainer.append(this.cell),setTimeout((function(){i.cell.css({opacity:""})}),1e3/30),this.cell.on("click",(function(t){"ready"==i.state&&(e.settings.insertMode?(i.cell.addClass("ilab-upload-selected"),e.uploadSelected(i)):window.open("post.php?post="+i.postId+"&action=edit","_blank").focus());return t.preventDefault(),!1}))},window.ilabMediaUploader=function(t,e){console.log("ilabMediaUploader"),console.log(e);var a=this;this.settings=e,this.clickToUpload=!e.hasOwnProperty("clickToUpload")||e.clickToUpload,this.insertButton=e.insertButton,this.uploadTarget=e.uploadTarget,this.cellContainer=e.cellContainer,this.attachmentContainer=e.attachmentContainer,this.uploadItemTemplate=e.uploadItemTemplate,this.attachmentTemplate=e.attachmentTemplate,this.uploadDirections=this.uploadTarget.find(".ilab-upload-directions"),this.hiddenFileInput=t('<input type="file" style="visibility:hidden" multiple="multiple">'),e.sendDirectory&&(this.uploadDirectory=null),this.waitingQueue=[],this.uploadingQueue=[],this.watchToken=null,this.currentSelection=null,this.attachmentInfo=null,this.watchQueue=function(){if(a.uploadingQueue.length<a.settings.maxUploads&&a.waitingQueue.length>0)for(var t=a.settings.maxUploads-a.uploadingQueue.length,e=0;e<t;e++)if(a.waitingQueue.length>0){var n=a.waitingQueue.shift();a.uploadingQueue.push(n),n.startUpload()}a.watchToken=setTimeout(a.watchQueue,500)},this.uploadSelected=function(e){if(console.log("uploadSelected"),a.currentSelection!=e){a.insertButton.prop("disabled",!0),a.currentSelection&&a.currentSelection.deselect(),a.currentSelection=e;var n={action:"ilab_upload_attachment_info",postId:e.postId};jQuery.post(ajaxurl,n,(function(e){t("body").addClass("ilab-item-selected"),a.attachmentInfo=new ilabAttachmentInfo(t,a,e),a.insertButton.prop("disabled",!1)}))}},this.uploadFinished=function(e){var n=a.uploadingQueue.indexOf(e);n>-1&&a.uploadingQueue.splice(n,1),clearTimeout(a.watchToken),a.watchQueue(),t(document).trigger("ilab.upload-finished")},this.openUpload=function(){console.log("openUpload"),a.hiddenFileInput.click()},this.setUploadDirectory=function(t){console.log("upload directory",t),e.sendDirectory&&(a.uploadDirectory=t)},this.addFile=function(n){if(""==n.type)return!1;console.log("addFile");var i=n.type;if("application/x-photoshop"==i&&(i="image/psd"),-1==e.allowedMimes.indexOf(i))return console.log(i+" not allowed"),!1;a.waitingQueue.push(new ilabMediaUploadItem(t,a,n,e.sendDirectory?a.uploadDirectory:null))},this.uploadTarget.on("dragenter dragover",(function(t){a.uploadTarget.addClass("drag-inside"),t.stopPropagation(),t.preventDefault()})),this.uploadTarget.on("dragleave drageexit",(function(t){a.uploadTarget.removeClass("drag-inside"),t.stopPropagation(),t.preventDefault()})),this.uploadTarget.on("drop",(function(t){a.uploadTarget.removeClass("drag-inside"),a.uploadDirections.css({display:"none"}),t.preventDefault();var e=t.originalEvent.dataTransfer.files;_.each(e,a.addFile)})),this.clickToUpload&&this.uploadTarget.on("click",(function(t){a.hiddenFileInput.click()})),this.hiddenFileInput.on("change",(function(t){a.uploadDirections.css({display:"none"});for(var e=0;e<this.files.length;e++)a.addFile(this.files[e])})),t("#ilab-open-editor").on("click",(function(t){return wp.media({frame:"select"}).open(),t.preventDefault(),!1})),this.insertButton.on("click",(function(t){return a.attachmentInfo&&a.attachmentInfo.insert(),t.preventDefault(),!1})),e.insertMode&&t("body").addClass("ilab-upload-insert-mode"),this.watchToken=setTimeout(this.watchQueue,500)}}});